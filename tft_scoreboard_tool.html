<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TFT SEA - Công cụ tính điểm</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { color: #d62828; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    input[type="number"], input[type="text"] { width: 80px; padding: 5px; }
    .group-title { background: #003049; color: white; padding: 10px; margin-top: 30px; display: flex; justify-content: space-between; align-items: center; }
    .group-title span { font-weight: bold; }
    button { padding: 10px 20px; margin: 10px 5px 0 0; cursor: pointer; background-color: #1982c4; color: white; border: none; }
    .results { margin-top: 20px; background: #edf2f4; padding: 10px; }
    .top1 { background-color: #ffd700 !important; }
    .top2 { background-color: #c0c0c0 !important; }
    .top3 { background-color: #cd7f32 !important; }
  </style>
</head>
<body>
  <h2>Công cụ tính điểm TFT SEA - Vòng loại Việt Nam</h2>

  <label for="pointConfig">Tùy chỉnh điểm theo hạng (cách nhau bởi dấu phẩy, ví dụ: 10,9,8,7,6,5,4,3):</label>
  <input type="text" id="pointConfig" value="8,7,6,5,4,3,2,1" style="width:300px" onchange="saveSettings()">
  <br><br>

  <label for="playersPerGroup">Số người mỗi bảng:</label>
  <input type="number" id="playersPerGroup" value="8" min="2" max="16" onchange="saveSettings()">

  <label for="roundCount">Số vòng đấu:</label>
  <input type="number" id="roundCount" value="3" min="1" max="10" onchange="saveSettings()">

  <br><br>
  <input type="file" id="fileInput" accept=".txt,.xlsx" />
  <button onclick="loadNames()">Nhập tên từ file</button>
  <button onclick="addGroup()">+ Thêm bảng đấu</button>
  <button onclick="exportToExcel()">Xuất kết quả toàn bộ</button>

  <div id="app"></div>

  <script>
    let rankPoints = [0, 8, 7, 6, 5, 4, 3, 2, 1];
    let totalGroups = 0;
    const allTables = [];

    function saveSettings() {
      const pointConfig = document.getElementById("pointConfig").value;
      const playersPerGroup = document.getElementById("playersPerGroup").value;
      const roundCount = document.getElementById("roundCount").value;
      localStorage.setItem("pointConfig", pointConfig);
      localStorage.setItem("playersPerGroup", playersPerGroup);
      localStorage.setItem("roundCount", roundCount);

      const groupData = [];
      document.querySelectorAll("[data-group]").forEach(container => {
        const table = container.querySelector("table");
        const groupRows = table.querySelectorAll("tr");
        const data = [];
        groupRows.forEach((row, index) => {
          if (index === 0) return;
          const inputs = row.querySelectorAll("input");
          const rowData = Array.from(inputs).map(input => input.value);
          data.push(rowData);
        });
        groupData.push(data);
      });
      localStorage.setItem("savedGroups", JSON.stringify(groupData));
    }

    function loadSettings() {
      if (localStorage.getItem("pointConfig")) {
        document.getElementById("pointConfig").value = localStorage.getItem("pointConfig");
      }
      if (localStorage.getItem("playersPerGroup")) {
        document.getElementById("playersPerGroup").value = localStorage.getItem("playersPerGroup");
      }
      if (localStorage.getItem("roundCount")) {
        document.getElementById("roundCount").value = localStorage.getItem("roundCount");
      }
      if (localStorage.getItem("savedGroups")) {
        const groupData = JSON.parse(localStorage.getItem("savedGroups"));
        renderGroupsFromSavedData(groupData);
      } else {
        addGroup();
      }
    }

    function renderGroupsFromSavedData(groups) {
      document.getElementById("app").innerHTML = "";
      allTables.length = 0;
      totalGroups = 0;
      groups.forEach((groupRows, index) => {
        totalGroups++;
        createGroupTable(totalGroups, groupRows.map(row => row[0]));
        const table = allTables[allTables.length - 1];
        const trs = table.querySelectorAll("tr");
        groupRows.forEach((rowData, i) => {
          const inputs = trs[i + 1].querySelectorAll("input");
          rowData.forEach((val, j) => {
            inputs[j].value = val;
          });
        });
      });
    }

    // (Giữ nguyên các hàm còn lại như addGroup, createGroupTable, calculateGroupPoints, removeGroup, exportToExcel...)

    window.onload = loadSettings;
  </script>
</body>
</html>
